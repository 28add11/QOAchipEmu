# TT07-QOA-Decoder-Emu
A Raspberry Pi Pico program designed to emulate the functionality and USB interface of [tt07_qoa_decode](https://github.com/28add11/tt07_qoa_decode)

This is intended to make developing the PC side of software for the real device much easier when it comes in late December!

![An image showing a terminal displaying information about samples and the time it took to complete those samples](https://cloud-1p09spafi-hack-club-bot.vercel.app/0image.png)

## Details
The chip this is meant to emulate is my ASIC for decoding [the QOA audio format](https://qoaformat.org/), which takes the audio as samples and all the data required to decode thoes, and accelerates it in hardware. This "emulator" is primarily meant to test the USB interface, with the decoding software being very simple.

## How to test it
The device works by having two virtual serial ports through the USB interface, one of which (idk which one, it'll be inconsistent) recives messages for processing, before sending data back through both in a round-robin style. You send history or weights data with a message like `lsb [bottom 4 bits of 'H' or 'W' (hist or weights)][index (2 bits)][data (16 bits)] msb` (lsb and msb are just least significant and most significant byte to be clear!), then send an `sf_quant` with `lsb 0100[sf_quant data (4 bits)] msb`. After sending all that data, we can get to samples. These are sent in a similar way to QOA itself, `lsb [0001][qr00][qr01]... [qr19] msb`. As soon as it is done processing the data, it is sent back as raw samples, with qr00 being turned into a sample at the lowest two bytes, still in little endian order. After that, you can do whatever you like with the samples.

The test program does this for you, checking if everything lines up based on a file generated by the modified QOA code from [here](https://github.com/28add11/tt07_qoa_decode/blob/main/test/qoa.h)
